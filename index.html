<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOW</title>
    <script src="https://unpkg.com/packery@2/dist/packery.pkgd.min.js"></script>
    <!-- <script src="packery.pkgd.min.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://unpkg.com/draggabilly@3/dist/draggabilly.pkgd.min.js"></script>
    <link rel="stylesheet" href="style.css">

    <script>

$(document).ready(function(){
    $('.button-container').click(function() {
        // Your code here
        var correct_order = true
        pckry.getItemElements().forEach(itemElem => {
            // console.log('Index:', $(itemElem).attr("index"));
            // console.log('Position of item:', itemElem.style.left);
            if (itemElem.style.left != $(itemElem).attr("index")*210+"px") {
              console.log('Position of item:', itemElem.style.left);
              console.log('Index:', $(itemElem).attr("index")*210+"px");
              correct_order = false
            }
            });
         if (correct_order == true){
          $('#result').text('Order is correct!');
         } else {
          $('#result').text('Order is not correct!');
         }
         
        
        update_button();
    });
  var i = 0;
  let arr = [0, 1, 2, 3, 4, 5, 6];
  arr.sort(() => Math.random() - 0.5);
  console.log(arr)
  pckry.getItemElements().forEach(itemElem => {
    $(itemElem).attr('index', i)
    console.log('This:',);
    itemElem.style.left=arr[i]*210+'px'
    i=(i+1);
  })
});

// jQuery
function update_button(event, pointer){
    pckry.getItemElements().forEach(itemElem => {

    });
}


document.addEventListener("DOMContentLoaded", runPackery, false);
var pckry;
function runPackery() {
  pckry = new Packery(".grid", {
    itemSelector: ".grid-item",
    columnWidth: 200,
    gutter: 10,
    horizontal: true
  });
  
  pckry.getItemElements().forEach(itemElem => {
    
    let draggie = new Draggabilly(itemElem, {
      //containment: '.grid', // limit item with in boundary of container
      handle: '.oxy-card-title',
      axis: 'x',
      containment: '.demo--containment__container'
    });
    draggie.on( 'dragEnd', update_button)
    pckry.bindDraggabillyEvents(draggie);
  });
  
  document.querySelector('.grid')
    .addEventListener('click', collapse, false);
}

function collapse(ev) {
  let isExpanded = false;
  let target = ev.target;
  let gridItem = target.closest('.grid-item');
  
  if (!target.getAttribute('class').match(/(collapsable|expand1x|expand2x)/i))   {
    return;
  }
  
  if (target.getAttribute('class').match(/collapsable/i)) {
      gridItem.classList.toggle('collapsed');
      isExpanded = !gridItem.classList.contains('collapsed');        
  }
  
  if (target.getAttribute('class').match(/expand1x/i) &&  gridItem.classList.contains('twox')) {
      gridItem.classList.remove('twox');
      isExpanded = false;        
  }
  
  if (target.getAttribute('class').match(/expand2x/i) &&  !gridItem.classList.contains('twox')) {
      gridItem.classList.add('twox');
      isExpanded = true;        
  }
  
  isExpanded ? pckry.fit(gridItem) : pckry.shiftLayout();
  
  
}

// if (window.Element && !Element.prototype.closest) {
//   Element.prototype.closest = function(s) {
//     var matches = (this.document || this.ownerDocument).querySelectorAll(s),
//       i,
//       el = this;
//     do {
//       i = matches.length;
//       while (--i >= 0 && matches.item(i) !== el) {}
//     } while (i < 0 && (el = el.parentElement));
//     return el;
//   };
// }

// (function ($) {
//   var number_elements = 7;
//   pckry.getItemElements().forEach(itemElem => {
//     console.log('This:',Math.random());
//   })
// })(jQuery);
// (function ($) {
  
//   $.fn.randomize = function (tree, childElem) {
//     console.log('This:', $(this));
//     return this.each(function () {
//       var $this = $(this);
//       if (tree) $this = $(this).find(tree);
//       var unsortedElems = $this.children(childElem);
//       var elems = unsortedElems.clone();

//       elems.sort(function () {
//         return Math.round(Math.random()) - 0.5;
//       });

//       for (var i = 0; i < elems.length; i++)
//         unsortedElems.eq(i).replaceWith(elems[i]);
//     });
//   };
// })(jQuery);

// $("div.grid").randomize("div.grid-item");

    </script>
</head>
<body>

    <div class="demo--containment__container">
        
    <div class="grid">

        <!---->
        <div class="grid-item  mdl-shadow--2dp">
          <oxy-card>
            <div class="oxy-card" style="background:#feabcd">
              <!---->
              <h6 class="oxy-card-title">Discovery of x-rays &nbsp;
                <!-- <span class="expand1x">1x</span>
                <span class="expand2x">2x</span> -->
              </h6>
              <img src="Pictures/First_medical_X-ray_by_Wilhelm_Röntgen.jpg" style="width:200px;">
              <span class="collapsable" type="button" style = "font-family: Arial, Helvetica, sans-serif">More information</span>
              <div class="oxy-card-content">
                <div>
                    The first medical x-ray image. Taken of Anna Bertha Ludwig's hand by Wilhelm Röntgen
                </div>
              </div>
            </div>
          </oxy-card>
        </div>
        
        <div class="grid-item twox ">
          <oxy-card>
            <div class="oxy-card mdl-shadow--2dp" style="background:#4286f4">
              <!---->
              <h6 class="oxy-card-title">Status 2  &nbsp;
                <span class="collapsable">C</span>
                <span class="expand1x">1x</span>
                <span class="expand2x">2x</span>
              </h6>
              <div class="oxy-card-content">
                <div>
                  <form>
                    name <input>
                    <button>button</button>
                  </form>
                  <br>
                  make sure form is accessible

                  Click on<br>
                  C : to collapse/expand<br>
                  1x : set the size to 1 unit<br>
                  2x : set the size to 2 unit<br>
                </div>
              </div>
            </div>
          </oxy-card>
        </div>
        
          <div class="grid-item  mdl-shadow--2dp">
          <oxy-card>
            <div class="oxy-card"  style="background:#84ffda">
              <!---->
              <h6 class="oxy-card-title">Status 3  &nbsp;
                <span class="collapsable">C</span>
                <span class="expand1x">1x</span>
                <span class="expand2x">2x</span>
              </h6>
              <div class="oxy-card-content">
                <div>
                  content
                </div>
              </div>
            </div>
          </oxy-card>
        </div>
        
          <div class="grid-item  mdl-shadow--2dp">
          <oxy-card>
            <div class="oxy-card" style="background:#d7ffba">
              <!---->
              <h6 class="oxy-card-title">Status 4  &nbsp;
                <span class="collapsable">C</span>
                <span class="expand1x">1x</span>
                <span class="expand2x">2x</span>
              </h6>
              <div class="oxy-card-content">
                <div>
                  content
                </div>
              </div>
            </div>
          </oxy-card>
        </div>
        
          <div class="grid-item  mdl-shadow--2dp">
          <oxy-card>
            <div class="oxy-card" style="background:#ffd3ba">
              <!---->
              <h6 class="oxy-card-title">Status 5  &nbsp;
                <span class="collapsable">C</span>
                <span class="expand1x">1x</span>
                <span class="expand2x">2x</span>
              </h6>
              <div class="oxy-card-content">
                <div>
                  content
                </div>
              </div>
            </div>
          </oxy-card>
        </div>
        
          <div class="grid-item  mdl-shadow--2dp">
          <oxy-card>
            <div class="oxy-card" style="background:#ffbaf2">
              <!---->
              <h6 class="oxy-card-title">Status 6  &nbsp;
                <span class="collapsable">C</span>
                <span class="expand1x">1x</span>
                <span class="expand2x">2x</span>
              </h6>
              <div class="oxy-card-content">
                <div>
                  content
                </div>
              </div>
            </div>
          </oxy-card>
        </div>
        
        <div class="grid-item  mdl-shadow--2dp">
          <oxy-card>
            <div class="oxy-card" style="background:#adffff">
              <!---->
              <h6 class="oxy-card-title">Status 7  &nbsp;
                <span class="collapsable">C</span>
                <span class="expand1x">1x</span>
                <span class="expand2x">2x</span>
              </h6>
              <div class="oxy-card-content">
                <div>
                  content
                </div>
              </div>
            </div>
          </oxy-card>
        </div>
      </div>

    </div>
      <div class="button-container">
        <button type="button">Click Me!</button>
    </div>
    <div id="result">
        <!-- Here to appear the result -->
    </div>
</body>
</html>